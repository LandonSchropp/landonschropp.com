#!/usr/bin/env bash

set -euo pipefail

# Configuration
content_directory="./content"
content_repository="https://github.com/LandonSchropp/resource-notes.git"

# Colors for output
green='\033[0;32m'
blue='\033[0;34m'
no_color='\033[0m'

# Remove existing content directory if it exists
if [ -d "$content_directory" ]; then
	echo -e "${blue}üóëÔ∏è Removing existing content directory...${no_color}"
	rm -rf "$content_directory"
fi

# Pre-populate credentials using credential helper (set locally, not globally)
git -c credential.helper=store credential approve <<EOF
url=${content_repository}
username=git
password=${GITHUB_TOKEN}
EOF

# Clone the repository using credential helper (prevents token from being stored in git config)
echo -e "${blue}üêë Cloning content repository...${no_color}"
git -c credential.helper=store clone --depth 1 "$content_repository" "$content_directory"

echo -e "${green}‚úÖ Content fetched successfully to ${content_directory}${no_color}"
